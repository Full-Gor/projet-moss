{% extends 'base.html.twig' %}

{% block body %}
	<div class="container">
		<h1>Mon Panier</h1>

		{# Si le panier est vide #}
		{% if panier is empty %}
			<div class="empty-cart">
				<p>Votre panier est vide.</p>
				<a href="{{ path('app_produit') }}" class="btn btn-primary">Continuer mes achats</a>
			</div>
		{% else %}
			{# Afficher les articles du panier #}
			<div class="cart-items">
				{% for item in panier %}
					<div class="cart-item">
						{# Image du produit #}
						<div class="item-image">
							{% if item.image %}
								<img src="{{ asset('images/produits/' ~ item.image) }}" alt="{{ item.name }}">
							{% else %}
								<img src="{{ asset('images/hero3.jpg') }}" alt="{{ item.name }}">
							{% endif %}
						</div>

						{# Informations du produit #}
						<div class="item-info">
							<h3>{{ item.name }}</h3>
							<p class="item-details">
								<strong>Prix unitaire:</strong> {{ item.price }}€<br>
								<strong>Quantité:</strong> {{ item.quantity }}<br>
								<strong>Stock restant:</strong>
								<span class="stock-badge">{{ item.stock }}</span>
							</p>
						</div>

						{# Prix et actions #}
						<div class="item-actions">
							{# Sous-total pour cet article #}
							<span class="price">{{ item.total|number_format(2, ',', ' ') }}€</span>

							{# Boutons quantité + et - #}
							<div class="quantity-controls">
								<a href="{{ path('app_panier_augmenter', {productId: item.productId}) }}"
								   class="btn btn-outline-secondary btn-quantity"
								   title="Augmenter la quantité">
									<i class="fas fa-plus"></i>
								</a>
								<a href="{{ path('app_panier_diminuer', {productId: item.productId}) }}"
								   class="btn btn-outline-secondary btn-quantity"
								   title="Diminuer la quantité">
									<i class="fas fa-minus"></i>
								</a>
								{# Bouton supprimer #}
								<a href="{{ path('app_panier_supprimer', {productId: item.productId}) }}"
								   class="btn btn-danger btn-quantity"
								   onclick="return confirm('Supprimer {{ item.name }} du panier ?')"
								   title="Supprimer">
									<i class="fas fa-trash"></i>
								</a>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>

			{# Résumé du panier #}
			<div class="cart-summary">
				<div class="total">
					<h3>Total: {{ total|number_format(2, ',', ' ') }}€</h3>
				</div>

				{# Actions du panier #}
				<div class="cart-actions">
					<a href="{{ path('app_panier_vider') }}"
					   class="btn btn-warning"
					   onclick="return confirm('Vider complètement le panier ?')">
						<i class="fas fa-trash-alt"></i> Vider le panier
					</a>

					{# Bouton pour ouvrir la modale de paiement #}
					<button type="button"
							class="btn btn-success"
							data-bs-toggle="modal"
							data-bs-target="#paymentModal">
						<i class="fas fa-shopping-cart"></i> Passer commande
					</button>
				</div>

				{# Bouton continuer les achats #}
				<div class="continue-shopping">
					<a href="{{ path('app_produit') }}" class="btn btn-outline-primary">
						<i class="fas fa-arrow-left"></i> Continuer mes achats
					</a>
				</div>
			</div>

			{# Modale de confirmation de paiement #}
			<div class="modal fade" id="paymentModal" tabindex="-1">
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Confirmer la commande</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body text-center">
							<p>Êtes-vous sûr de vouloir valider cette commande ?</p>
							<p><strong>Total: {{ total|number_format(2, ',', ' ') }}€</strong></p>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
							{# Formulaire de validation #}
							<form action="{{ path('app_panier_paiement_effectue') }}" method="POST" style="display: inline;">
								<button type="submit" class="btn btn-success">
									<i class="fas fa-check"></i> Valider le paiement
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>

		{% endif %}
	</div>

	<style>
		/* Conteneur principal */
		.container {
			max-width: 1200px;
			margin: 2rem auto;
			padding: 0 1rem;
		}

		.container h1 {
			margin-bottom: 2rem;
			color: #2c5530;
		}

		/* Liste des articles */
		.cart-items {
			margin-bottom: 2rem;
		}

		/* Un article du panier */
		.cart-item {
			display: flex;
			gap: 1.5rem;
			align-items: center;
			padding: 1.5rem;
			border: 1px solid #ddd;
			border-radius: 10px;
			margin-bottom: 1rem;
			background: white;
			box-shadow: 0 2px 5px rgba(0,0,0,0.05);
		}

		/* Image du produit */
		.item-image {
			flex-shrink: 0;
			width: 100px;
			height: 100px;
		}

		.item-image img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			border-radius: 8px;
		}

		/* Informations du produit */
		.item-info {
			flex: 1;
		}

		.item-info h3 {
			margin: 0 0 0.5rem;
			color: #333;
			font-size: 1.3rem;
		}

		.item-details {
			margin: 0;
			color: #666;
			line-height: 1.6;
		}

		/* Badge de stock */
		.stock-badge {
			display: inline-block;
			padding: 0.2rem 0.5rem;
			background: #d4edda;
			color: #155724;
			border-radius: 4px;
			font-weight: 600;
			font-size: 0.9rem;
		}

		/* Prix et actions */
		.item-actions {
			text-align: right;
			display: flex;
			flex-direction: column;
			gap: 0.75rem;
			align-items: flex-end;
		}

		.price {
			font-size: 1.5rem;
			font-weight: bold;
			color: #4a7c59;
		}

		/* Boutons de quantité */
		.quantity-controls {
			display: flex;
			gap: 0.5rem;
			align-items: center;
		}

		.btn-quantity {
			width: 40px;
			height: 40px;
			padding: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 8px;
			font-size: 1rem;
			transition: all 0.2s ease;
		}

		.btn-quantity:hover {
			transform: scale(1.1);
		}

		.btn-quantity.btn-outline-secondary:hover {
			background-color: #6c757d;
			color: white;
		}

		/* Résumé du panier */
		.cart-summary {
			background: linear-gradient(135deg, #f8f9fa, #e9ecef);
			padding: 2rem;
			border-radius: 10px;
			text-align: center;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
		}

		.total h3 {
			color: #4a7c59;
			margin-bottom: 1.5rem;
			font-size: 2rem;
		}

		/* Boutons d'action */
		.cart-actions {
			display: flex;
			gap: 1rem;
			justify-content: center;
			flex-wrap: wrap;
		}

		/* Bouton continuer les achats */
		.continue-shopping {
			margin-top: 1.5rem;
			padding-top: 1.5rem;
			border-top: 1px solid #dee2e6;
		}

		.continue-shopping .btn {
			padding: 0.75rem 2rem;
			font-weight: 600;
			border-radius: 25px;
			transition: all 0.3s ease;
		}

		.continue-shopping .btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 10px rgba(0,0,0,0.15);
		}

		/* Panier vide */
		.empty-cart {
			text-align: center;
			padding: 4rem 2rem;
			background: #f8f9fa;
			border-radius: 10px;
		}

		.empty-cart p {
			font-size: 1.3rem;
			color: #666;
			margin-bottom: 1.5rem;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.cart-item {
				flex-direction: column;
				text-align: center;
			}

			.item-image {
				width: 150px;
				height: 150px;
			}

			.item-price {
				align-items: center;
			}

			.cart-actions {
				flex-direction: column;
			}

			.cart-actions .btn {
				width: 100%;
			}
		}
	</style>
{% endblock %}
