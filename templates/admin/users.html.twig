{% extends 'base.html.twig' %}

{% block title %}Gestion des Utilisateurs - Admin{% endblock %}

{% block body %}
<div class="container mt-4">
	<!-- Titre et lien retour -->
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1>Gestion des Utilisateurs</h1>
		<a href="{{ path('app_admin_dashboard') }}" class="btn btn-secondary">
			<i class="fas fa-arrow-left"></i> Retour Dashboard
		</a>
	</div>

	<!-- Messages de succès -->
	{% for message in app.flashes('success') %}
		<div class="alert alert-success alert-dismissible fade show">
			{{ message }}
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
	{% endfor %}

	<!-- Messages d'erreur -->
	{% for message in app.flashes('error') %}
		<div class="alert alert-danger alert-dismissible fade show">
			{{ message }}
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
	{% endfor %}

	<!-- Tableau des utilisateurs -->
	<div class="card">
		<div class="card-header">
			<h5 class="mb-0">Liste des Utilisateurs ({{ users|length }})</h5>
		</div>
		<div class="card-body">
			{% if users|length > 0 %}
				<div class="table-responsive">
					<table class="table table-striped">
						<thead>
							<tr>
								<th>ID</th>
								<th>Prénom</th>
								<th>Nom</th>
								<th>Email</th>
								<th>Rôle</th>
								<th>Date inscription</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for user in users %}
								<tr>
									<td>{{ user.id }}</td>
									<td>{{ user.prenom }}</td>
									<td>{{ user.nom }}</td>
									<td>{{ user.email }}</td>
									<td>
										<!-- Badge pour le rôle -->
										<span class="badge bg-{{ user.role == 'admin' ? 'danger' : 'primary' }}">
											{{ user.role == 'admin' ? 'Admin' : 'Utilisateur' }}
										</span>
									</td>
									<td>{{ user.created_at|date('d/m/Y H:i') }}</td>
									<td>
										<!-- Formulaire pour changer le rôle -->
										<form method="POST" action="{{ path('app_admin_user_role', {id: user.id}) }}" class="d-inline">
											<select name="role" class="form-select form-select-sm d-inline" style="width: auto;" onchange="this.form.submit()">
												<option value="user" {{ user.role == 'user' ? 'selected' : '' }}>User</option>
												<option value="admin" {{ user.role == 'admin' ? 'selected' : '' }}>Admin</option>
											</select>
										</form>

										<!-- Bouton supprimer -->
										<form method="POST" action="{{ path('app_admin_user_delete', {id: user.id}) }}" class="d-inline" onsubmit="return confirm('Supprimer cet utilisateur ?')">
											<input type="hidden" name="_token" value="{{ csrf_token('delete_user' ~ user.id) }}">
											<button type="submit" class="btn btn-sm btn-danger">
												<i class="fas fa-trash"></i>
											</button>
										</form>
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			{% else %}
				<p class="text-center text-muted">Aucun utilisateur trouvé</p>
			{% endif %}
		</div>
	</div>
</div>
{% endblock %}
