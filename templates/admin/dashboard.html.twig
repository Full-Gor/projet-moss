{% extends 'base.html.twig' %}

{% block title %}Dashboard Admin - MossAir
{% endblock %}

{% block body %}
	<div class="container mt-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h1>Dashboard Admin</h1>
			<div>
				<!-- Lien vers gestion des utilisateurs -->
				<a href="{{ path('app_admin_users') }}" class="btn btn-info me-2">
					<i class="fas fa-users"></i> Utilisateurs
				</a>
				<!-- Lien pour ajouter un produit -->
				<a href="{{ path('app_admin_produit_new') }}" class="btn btn-primary">
					<i class="fas fa-plus"></i> Nouveau Produit
				</a>
			</div>
		</div>

		{% for message in app.flashes('success') %}
			<div class="alert alert-success alert-dismissible fade show" role="alert">
				{{ message }}
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>
		{% endfor %}

		{% for message in app.flashes('error') %}
			<div class="alert alert-danger alert-dismissible fade show" role="alert">
				{{ message }}
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>
		{% endfor %}

		<div class="card">
			<div class="card-header">
				<h5 class="mb-0">Gestion des Produits</h5>
			</div>
			<div class="card-body">
				{% if produits|length > 0 %}
					<div class="table-responsive">
						<table class="table table-striped">
							<thead>
								<tr>
									<th>ID</th>
									<th>Image</th>
									<th>Nom</th>
									<th>Prix</th>
									<th>Stock</th>
									<th>Statut</th>
									<th>Date création</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody>
								{% for produit in produits %}
									<tr>
										<td>{{ produit.id }}</td>
										<td>
											{% if produit.image %}
												<img src="{{ asset('images/produits/' ~ produit.image) }}" alt="{{ produit.nom }}" style="width: 50px; height: 50px; object-fit: cover;">
											{% else %}
												<div class="bg-light text-muted d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
													<i class="fas fa-image"></i>
												</div>
											{% endif %}
										</td>
										<td>{{ produit.nom }}</td>
										<td>{{ produit.prix|number_format(2, ',', ' ') }}€</td>
										<td>
											{# Afficher le stock avec badge coloré selon la quantité #}
											{% if produit.stock == 0 %}
												<span class="badge bg-danger">Rupture</span>
											{% elseif produit.stock < 10 %}
												<span class="badge bg-warning text-dark">{{ produit.stock }} (Faible)</span>
											{% else %}
												<span class="badge bg-success">{{ produit.stock }}</span>
											{% endif %}
										</td>
										<td>
											<span class="badge bg-{{ produit.actif ? 'success' : 'danger' }}">
												{{ produit.actif ? 'Actif' : 'Inactif' }}
											</span>
										</td>
										<td>{{ produit.createdAt|date('d/m/Y H:i') }}</td>
										<td>
											<a href="{{ path('app_admin_produit_edit', {id: produit.id}) }}" class="btn btn-sm btn-warning">
												<i class="fas fa-edit"></i>
											</a>
											<form method="POST" action="{{ path('app_admin_produit_delete', {id: produit.id}) }}" class="d-inline" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')">
												<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ produit.id) }}">
												<button type="submit" class="btn btn-sm btn-danger">
													<i class="fas fa-trash"></i>
												</button>
											</form>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% else %}
					<div class="text-center py-4">
						<i class="fas fa-box fa-3x text-muted mb-3"></i>
						<p class="text-muted">Aucun produit trouvé</p>
						<a href="{{ path('app_admin_produit_new') }}" class="btn btn-primary">
							Créer le premier produit
						</a>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}
