<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>
			{% block title %}MossAir - Purificateur d'air naturel
			{% endblock %}
		</title>
		<link rel="stylesheet" href="{{ asset('css/style.css') }}">
		<link rel="stylesheet" href="{{ asset('css/header.css') }}">
		<link rel="stylesheet" href="{{ asset('css/main.css') }}">
		<link rel="stylesheet" href="{{ asset('css/footer.css') }}">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="{{ asset('css/responsive.css') }}">
		<link rel="stylesheet" href="{{ asset('css/rgpd.css') }}">
		<link
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

		<!--
			Google Analytics est chargé dynamiquement par rgpd.js
			après consentement de l'utilisateur (conformité RGPD)
		-->

		<!-- Meta tags SEO -->
		<meta name="description" content="{% block meta_description %}MossAir - Purificateur d'air naturel révolutionnaire utilisant la mousse vivante pour créer un environnement plus sain. Découvrez notre technologie innovante.{% endblock %}">
		<meta name="keywords" content="{% block meta_keywords %}purificateur d'air, mousse, air pur, environnement sain, MossAir, technologie verte{% endblock %}">
		<meta name="author" content="MossAir">
		<meta
		name="robots" content="index, follow">

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website">
		<meta property="og:url" content="{{ app.request.uri }}">
		<meta property="og:title" content="{% block og_title %}MossAir - Purificateur d'air naturel{% endblock %}">
		<meta property="og:description" content="{% block og_description %}Purificateur d'air naturel révolutionnaire utilisant la mousse vivante pour créer un environnement plus sain.{% endblock %}">
		<meta
		property="og:image" content="{% block og_image %}{{ app.request.schemeAndHttpHost }}{{ asset('images/hero2.jpg') }}{% endblock %}">

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image">
		<meta property="twitter:url" content="{{ app.request.uri }}">
		<meta property="twitter:title" content="{% block twitter_title %}MossAir - Purificateur d'air naturel{% endblock %}">
		<meta property="twitter:description" content="{% block twitter_description %}Purificateur d'air naturel révolutionnaire utilisant la mousse vivante pour créer un environnement plus sain.{% endblock %}">
		<meta
		property="twitter:image" content="{% block twitter_image %}{{ app.request.schemeAndHttpHost }}{{ asset('images/hero2.jpg') }}{% endblock %}">

		<!-- Canonical URL -->
		<link
		rel="canonical" href="{{ app.request.uri }}">

		<!-- Sitemap -->
		<link rel="sitemap" type="application/xml" href="{{ path('app_sitemap') }}"> {% block stylesheets %}{% endblock %}
		</head>
		<body>
			<nav class="navbar">
				<div class="nav-container">
					<a href="{{ path('app_home') }}" class="logo" id="siteLogo">
						MossAir</a>

					<!-- Bouton hamburger pour mobile -->
					<button class="hamburger" id="hamburger" aria-label="Menu" aria-expanded="false">
						<span></span>
						<span></span>
						<span></span>
					</button>
					<ul class="nav-menu" id="navMenu">
						<li>
							<a href="{{ path('app_home') }}">Accueil</a>
						</li>
						<li>
							<a href="{{ path('app_produit') }}">Produit</a>
						</li>
						<li>
							<a href="{{ path('app_histoire') }}">Histoire</a>
						</li>
						<li>
							<a href="{{ path('app_about') }}">À propos</a>
						</li>
						<li>
							<a href="{{ path('app_panier') }}" class="cart">Panier</a>
						</li>
						{% if app.session.get('user') %}
							{# Si l'utilisateur est admin, afficher le lien Dashboard #}
							{% if app.session.get('user').role == 'admin' %}
								<li>
									<a href="{{ path('app_admin_dashboard') }}" class="admin-link" style="background-color: #dc3545; padding: 0.5rem 1rem; border-radius: 20px;">
										<i class="fas fa-crown"></i> Dashboard
									</a>
								</li>
							{% endif %}
							<li>
								<a href="{{ path('app_profile') }}" class="profile-link">
									<img src="{{ asset('images/profiles/' ~ (app.session.get('user').photo ?? 'default-avatar.jpg')) }}" alt="Photo de profil">
									{{ app.session.get('user').nom }}
								</a>
							</li>
							<li>
								<a href="{{ path('app_deconnexion') }}" class="logout-btn">
									<i class="fas fa-sign-out-alt"></i>
									Déconnexion
								</a>
							</li>
						{% else %}
							<li>
								<a href="{{ path('app_connexion') }}" class="login-btn">
									<i class="fas fa-sign-in-alt"></i>
									Connexion
								</a>
							</li>
						{% endif %}
					</ul>
				</div>
			</nav>

			<main class="main-content"> {% block body %}{% endblock %}
				</main>

				<footer class="footer">
					<div class="footer-container">
						<div class="footer-column">
							<h4>Environ</h4>
							<p>Mosslab considère la beauté et les avantages de la mousse comme une alternative concise et durable à la verdure traditionnelle. Notre mission est de rapprocher la nature de la vie urbaine, en créant des espaces verts luxuriants qui prospèrent même dans les environnements urbains les plus fréquentés.</p>
						</div>
						<div class="footer-column">
							<h4>Boutique</h4>
							<ul>
								<li><ahref="{{ path('app_produit') }}">Moss Air</a></li>
								<li><a href="#">Double Air Mousse</a></li>
								<li><a href="#">Sac à dos tout-en-un Moss Air</a></li>
								<li><a href="#">Filtre à mousse</a></li>
							</ul>
						</div>
						<div class="footer-column">
							<h4>Ressources</h4>
							<ul>
								<li><a href="{{ path('app_histoire') }}">Histoire</a></li>
							</ul>
						</div>
						<div class="footer-column">
							<h4>Support</h4>
							<ul>
								<li>
									<a href="{{ path('app_privacy') }}">Politique de confidentialité</a>
								</li>
								<li>
									<a href="{{ path('app_cgv') }}">CGV</a>
								</li>
								<li>
									<a href="#" onclick="resetCookieConsent(); return false;">Gérer mes cookies</a>
								</li>
							</ul>
							<div class="social-links">
								<a href="https://facebook.com" target="_blank"></a>
								<a href="https://instagram.com" target="_blank"></a>
								<a href="https://twitter.com" target="_blank"></a>
							</div>
						</div>
					</div>
				</footer>

			{# ========== BANNIÈRE COOKIES RGPD ========== #}
			<div id="cookie-banner" class="cookie-banner hidden">
				<div class="cookie-content">
					<div class="cookie-text">
						Nous utilisons des cookies pour améliorer votre expérience.
						<a href="{{ path('app_privacy') }}">En savoir plus</a>
					</div>
					<div class="cookie-buttons">
						<button class="cookie-btn accept" onclick="acceptAllCookies()">Tout accepter</button>
						<button class="cookie-btn refuse" onclick="refuseAllCookies()">Tout refuser</button>
						<button class="cookie-btn customize" onclick="toggleCustomizePanel()">Personnaliser</button>
					</div>
					{# Panneau personnalisation #}
					<div id="cookie-customize-panel" class="cookie-customize-panel">
						<div class="cookie-option">
							<input type="checkbox" id="cookie-necessary" checked disabled>
							<label for="cookie-necessary"><strong>Nécessaires</strong> - Indispensables</label>
						</div>
						<div class="cookie-option">
							<input type="checkbox" id="cookie-analytics">
							<label for="cookie-analytics"><strong>Analytiques</strong> - Statistiques</label>
						</div>
						<div class="cookie-option">
							<input type="checkbox" id="cookie-marketing">
							<label for="cookie-marketing"><strong>Marketing</strong> - Publicités</label>
						</div>
						<button class="cookie-btn accept" onclick="saveCustomPreferences()" style="margin-top: 1rem;">
							Sauvegarder
						</button>
					</div>
				</div>
			</div>

			{# ========== MODALE ADMIN (3 clics sur logo) ========== #}
			<div class="modal fade" id="adminModal" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title"><i class="fas fa-lock"></i> Accès Admin</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body">
							<form id="adminForm">
								<div class="mb-3">
									<label for="adminPassword" class="form-label">Mot de passe</label>
									<input type="password" class="form-control" id="adminPassword" required>
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
							<button type="button" class="btn btn-primary" onclick="checkAdminPassword()">Accéder</button>
						</div>
					</div>
				</div>
			</div>

			{# ========== SCRIPTS ========== #}
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
			<script src="{{ asset('js/rgpd.js') }}"></script>
			{% block javascripts %}{% endblock %}

			<script>
			// Menu hamburger responsive
			(function() {
				function initBurger() {
					const hamburger = document.getElementById('hamburger');
					const navMenu = document.getElementById('navMenu');
					if (!hamburger || !navMenu) return;

					hamburger.addEventListener('click', function(e) {
						e.preventDefault();
						hamburger.classList.toggle('active');
						navMenu.classList.toggle('active');
						hamburger.setAttribute('aria-expanded', navMenu.classList.contains('active'));
					});

					navMenu.querySelectorAll('a').forEach(link => {
						link.addEventListener('click', () => {
							hamburger.classList.remove('active');
							navMenu.classList.remove('active');
							hamburger.setAttribute('aria-expanded', 'false');
						});
					});
				}

				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', initBurger);
				} else {
					initBurger();
				}
			})();

			// Accès admin (Ctrl+A ou 3 clics sur logo)
			document.addEventListener('DOMContentLoaded', function() {
				let clickCount = 0;
				let clickTimer = null;

				document.addEventListener('keydown', function(e) {
					if (e.ctrlKey && e.key === 'a') {
						e.preventDefault();
						window.location.href = '{{ path('app_admin_dashboard') }}';
					}
				});

				const siteLogo = document.getElementById('siteLogo');
				if (siteLogo) {
					siteLogo.addEventListener('click', function(e) {
						e.preventDefault();
						e.stopPropagation();
						clickCount++;
						if (clickTimer) clearTimeout(clickTimer);

						if (clickCount >= 3) {
							const modal = document.getElementById('adminModal');
							if (modal && typeof bootstrap !== 'undefined') {
								new bootstrap.Modal(modal).show();
							}
							clickCount = 0;
							return;
						}

						clickTimer = setTimeout(() => {
							window.location.href = siteLogo.href;
							clickCount = 0;
						}, 600);
					});
				}

				document.addEventListener('click', function(e) {
					if (!e.target.closest('#siteLogo')) {
						clickCount = 0;
						if (clickTimer) clearTimeout(clickTimer);
					}
				});

				window.checkAdminPassword = function() {
					const input = document.getElementById('adminPassword');
					const password = input.value;

					if (password === 'admin123') {
						window.location.href = '{{ path('app_admin_dashboard') }}';
					} else {
						input.value = '';
						input.classList.add('is-invalid');

						let errorDiv = document.querySelector('.invalid-feedback');
						if (!errorDiv) {
							errorDiv = document.createElement('div');
							errorDiv.className = 'invalid-feedback d-block';
							errorDiv.textContent = 'Mot de passe incorrect !';
							input.parentNode.appendChild(errorDiv);
						}

						setTimeout(() => {
							input.classList.remove('is-invalid');
							if (errorDiv) errorDiv.remove();
						}, 3000);
					}
				};
			});
			</script>

			<style>
					.navbar {
						background: linear-gradient(135deg, #4a7c59, #6b8e7a);
						padding: 1.5rem 0;
						box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
						min-height: 80px;
					}

					.navbar-brand {
						font-size: 1.5rem;
						font-weight: bold;
					}

					.navbar-nav .nav-link {
						padding: 0.75rem 1rem;
						font-weight: 500;
					}

					.login-btn,
					.logout-btn,
					.profile-link {
						transition: all 0.3s ease;
						display: flex;
						align-items: center;
						gap: 0.5rem;
					}

					.login-btn:hover,
					.logout-btn:hover,
					.profile-link:hover {
						transform: translateY(-2px);
					}

					.profile-link {
						color: #4a7c59 !important;
						font-weight: 600;
					}

					.profile-link img {
						width: 32px;
						height: 32px;
						border-radius: 50%;
						object-fit: cover;
						border: 2px solid #fff;
					}

					.logout-btn {
						color: #dc3545 !important;
					}

					.logout-btn:hover {
						color: #c82333 !important;
					}

					/* Styles pour la modale admin */
					#adminModal .modal-header {
						background: linear-gradient(135deg, #4a7c59, #6b8e7a);
						color: white;
					}

					#adminModal .modal-header .btn-close {
						filter: invert(1);
					}

					#adminModal .alert-info {
						background: linear-gradient(135deg, #d1ecf1, #bee5eb);
						border-color: #bee5eb;
						color: #0c5460;
					}

					#adminModal .btn-primary {
						background: linear-gradient(135deg, #4a7c59, #6b8e7a);
						border: none;
					}

					#adminModal .btn-primary:hover {
						background: linear-gradient(135deg, #3d6b4a, #5a7a66);
					}
				</style>
			</body>
		</html>
