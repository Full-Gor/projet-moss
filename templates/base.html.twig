<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>
			{% block title %}MossAir - Purificateur d'air naturel
			{% endblock %}
		</title>
		<link rel="stylesheet" href="{{ asset('css/style.css') }}">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="{{ asset('css/responsive.css') }}">
		<link rel="stylesheet" href="{{ asset('css/rgpd.css') }}">
		<link
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

		<!--
			Google Analytics est chargé dynamiquement par rgpd.js
			après consentement de l'utilisateur (conformité RGPD)
		-->

		<!-- Meta tags SEO -->
		<meta name="description" content="{% block meta_description %}MossAir - Purificateur d'air naturel révolutionnaire utilisant la mousse vivante pour créer un environnement plus sain. Découvrez notre technologie innovante.{% endblock %}">
		<meta name="keywords" content="{% block meta_keywords %}purificateur d'air, mousse, air pur, environnement sain, MossAir, technologie verte{% endblock %}">
		<meta name="author" content="MossAir">
		<meta
		name="robots" content="index, follow">

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website">
		<meta property="og:url" content="{{ app.request.uri }}">
		<meta property="og:title" content="{% block og_title %}MossAir - Purificateur d'air naturel{% endblock %}">
		<meta property="og:description" content="{% block og_description %}Purificateur d'air naturel révolutionnaire utilisant la mousse vivante pour créer un environnement plus sain.{% endblock %}">
		<meta
		property="og:image" content="{% block og_image %}{{ app.request.schemeAndHttpHost }}{{ asset('images/hero2.jpg') }}{% endblock %}">

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image">
		<meta property="twitter:url" content="{{ app.request.uri }}">
		<meta property="twitter:title" content="{% block twitter_title %}MossAir - Purificateur d'air naturel{% endblock %}">
		<meta property="twitter:description" content="{% block twitter_description %}Purificateur d'air naturel révolutionnaire utilisant la mousse vivante pour créer un environnement plus sain.{% endblock %}">
		<meta
		property="twitter:image" content="{% block twitter_image %}{{ app.request.schemeAndHttpHost }}{{ asset('images/hero2.jpg') }}{% endblock %}">

		<!-- Canonical URL -->
		<link
		rel="canonical" href="{{ app.request.uri }}">

		<!-- Sitemap -->
		<link rel="sitemap" type="application/xml" href="{{ path('app_sitemap') }}"> {% block stylesheets %}{% endblock %}
		</head>
		<body>
			<nav class="navbar">
				<div class="nav-container">
					<a href="{{ path('app_home') }}" class="logo" id="siteLogo">
						MossAir</a>

					<!-- Bouton hamburger pour mobile -->
					<button class="hamburger" id="hamburger" aria-label="Menu" aria-expanded="false">
						<span></span>
						<span></span>
						<span></span>
					</button>
					<ul class="nav-menu" id="navMenu">
						<li>
							<a href="{{ path('app_home') }}">Accueil</a>
						</li>
						<li>
							<a href="{{ path('app_produit') }}">Produit</a>
						</li>
						<li>
							<a href="{{ path('app_histoire') }}">Histoire</a>
						</li>
						<li>
							<a href="{{ path('app_about') }}">À propos</a>
						</li>
						<li>
							<a href="{{ path('app_panier') }}" class="cart">Panier</a>
						</li>
						{% if app.session.get('user') %}
							{# Si l'utilisateur est admin, afficher le lien Dashboard #}
							{% if app.session.get('user').role == 'admin' %}
								<li>
									<a href="{{ path('app_admin_dashboard') }}" class="admin-link" style="background-color: #dc3545; padding: 0.5rem 1rem; border-radius: 20px;">
										<i class="fas fa-crown"></i> Dashboard
									</a>
								</li>
							{% endif %}
							<li>
								<a href="{{ path('app_profile') }}" class="profile-link">
									<img src="{{ asset('images/profiles/' ~ (app.session.get('user').photo ?? 'default-avatar.jpg')) }}" alt="Photo de profil">
									{{ app.session.get('user').nom }}
								</a>
							</li>
							<li>
								<a href="{{ path('app_deconnexion') }}" class="logout-btn">
									<i class="fas fa-sign-out-alt"></i>
									Déconnexion
								</a>
							</li>
						{% else %}
							<li>
								<a href="{{ path('app_connexion') }}" class="login-btn">
									<i class="fas fa-sign-in-alt"></i>
									Connexion
								</a>
							</li>
						{% endif %}
					</ul>
				</div>
			</nav>

			<main class="main-content"> {% block body %}{% endblock %}
				</main>

				<footer class="footer">
					<div class="footer-container">
						<div class="footer-column">
							<h4>Environ</h4>
							<p>Mosslab considère la beauté et les avantages de la mousse comme une alternative concise et durable à la verdure traditionnelle. Notre mission est de rapprocher la nature de la vie urbaine, en créant des espaces verts luxuriants qui prospèrent même dans les environnements urbains les plus fréquentés.</p>
						</div>
						<div class="footer-column">
							<h4>Boutique</h4>
							<ul>
								<li><ahref="{{ path('app_produit') }}">Moss Air</a></li>
								<li><a href="#">Double Air Mousse</a></li>
								<li><a href="#">Sac à dos tout-en-un Moss Air</a></li>
								<li><a href="#">Filtre à mousse</a></li>
							</ul>
						</div>
						<div class="footer-column">
							<h4>Ressources</h4>
							<ul>
								<li><a href="{{ path('app_histoire') }}">Histoire</a></li>
							</ul>
						</div>
						<div class="footer-column">
							<h4>Support</h4>
							<ul>
								<li>
									<a href="{{ path('app_privacy') }}">Politique de confidentialité</a>
								</li>
								<li>
									<a href="{{ path('app_cgv') }}">CGV</a>
								</li>
								<li>
									<a href="#" onclick="resetCookieConsent(); return false;">Gérer mes cookies</a>
								</li>
							</ul>
							<div class="social-links">
								<a href="https://facebook.com" target="_blank"></a>
								<a href="https://instagram.com" target="_blank"></a>
								<a href="https://twitter.com" target="_blank"></a>
							</div>
						</div>
					</div>
				</footer>

				{# ============================================
				   BANNIÈRE COOKIES RGPD
				   ============================================

				   Structure HTML de la bannière de consentement.

				   PRINCIPE TWIG :
				   - {# ... #} = commentaire Twig (non affiché dans le HTML final)
				   - Les classes CSS correspondent à celles définies dans rgpd.css
				   - Les onclick appellent les fonctions définies dans rgpd.js

				   PRINCIPE RGPD :
				   - La bannière doit être visible AVANT tout tracking
				   - L'utilisateur doit pouvoir accepter, refuser ou personnaliser
				   - Un lien vers la politique de confidentialité est obligatoire
				#}
				<div id="cookie-banner" class="cookie-banner hidden">
					<div class="cookie-content">
						{# Texte explicatif - doit être clair et compréhensible #}
						<div class="cookie-text">
							Nous utilisons des cookies pour améliorer votre expérience sur notre site.
							Les cookies nécessaires sont indispensables au fonctionnement du site.
							Vous pouvez accepter ou refuser les cookies optionnels.
							<a href="{{ path('app_privacy') }}">En savoir plus</a>
						</div>

						{# Boutons d'action - doivent être clairement visibles #}
						<div class="cookie-buttons">
							{# onclick = événement JavaScript déclenché au clic #}
							<button class="cookie-btn accept" onclick="acceptAllCookies()">
								Tout accepter
							</button>
							<button class="cookie-btn refuse" onclick="refuseAllCookies()">
								Tout refuser
							</button>
							<button class="cookie-btn customize" onclick="toggleCustomizePanel()">
								Personnaliser
							</button>
						</div>

						{# Panneau de personnalisation - caché par défaut #}
						<div id="cookie-customize-panel" class="cookie-customize-panel">
							{# Option cookies nécessaires - toujours cochée et désactivée #}
							<div class="cookie-option">
								<input type="checkbox" id="cookie-necessary" checked disabled>
								<label for="cookie-necessary">
									<strong>Nécessaires</strong> - Indispensables au fonctionnement du site
								</label>
							</div>

							{# Option cookies analytiques - désactivée par défaut #}
							<div class="cookie-option">
								<input type="checkbox" id="cookie-analytics">
								<label for="cookie-analytics">
									<strong>Analytiques</strong> - Nous aident à comprendre comment vous utilisez le site
								</label>
							</div>

							{# Option cookies marketing - désactivée par défaut #}
							<div class="cookie-option">
								<input type="checkbox" id="cookie-marketing">
								<label for="cookie-marketing">
									<strong>Marketing</strong> - Permettent d'afficher des publicités pertinentes
								</label>
							</div>

							{# Bouton pour sauvegarder les préférences personnalisées #}
							<button class="cookie-btn accept" onclick="saveCustomPreferences()" style="margin-top: 1rem;">
								Sauvegarder mes préférences
							</button>
						</div>
					</div>
				</div>

				<!-- Modale Admin -->
				<div class="modal fade" id="adminModal" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="adminModalLabel">
									<i class="fas fa-lock"></i>
									Accès Administrateur
								</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<div class="alert alert-info">
									<i class="fas fa-info-circle"></i>
									<strong>Accès sécurisé :</strong>
									Entrez le mot de passe administrateur pour accéder au CRUD des produits.
								</div>
								<form id="adminForm">
									<div class="mb-3">
										<label for="adminPassword" class="form-label">Mot de passe</label>
										<input type="password" class="form-control" id="adminPassword" placeholder="Entrez le mot de passe" required autocomplete="new-password">
									</div>
								</form>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
								<button type="button" class="btn btn-primary" onclick="checkAdminPassword()">
									<i class="fas fa-sign-in-alt"></i>
									Accéder
								</button>
							</div>
						</div>
					</div>
				</div>

				<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
				<script src="{{ asset('js/rgpd.js') }}"></script>
				{% block javascripts %}{% endblock %}

				<!-- Script pour le menu burger -->
				<script>
					// Menu hamburger - doit s'exécuter en premier
					(function() {
						console.log('Script burger chargé');

						function initBurger() {
							const hamburger = document.getElementById('hamburger');
							const navMenu = document.getElementById('navMenu');

							console.log('Init burger - Hamburger:', hamburger);
							console.log('Init burger - NavMenu:', navMenu);

							if (!hamburger || !navMenu) {
								console.error('Éléments non trouvés!');
								return;
							}

							console.log('Éléments trouvés, ajout du listener');

							hamburger.addEventListener('click', function(e) {
								console.log('=== CLIC DÉTECTÉ ===');
								e.preventDefault();
								e.stopPropagation();

								const wasActive = navMenu.classList.contains('active');

								hamburger.classList.toggle('active');
								navMenu.classList.toggle('active');

								const isActive = navMenu.classList.contains('active');
								const isExpanded = hamburger.getAttribute('aria-expanded') === 'true';
								hamburger.setAttribute('aria-expanded', !isExpanded);

								console.log('État avant:', wasActive);
								console.log('État après:', isActive);
								console.log('Classes hamburger:', hamburger.className);
								console.log('Classes navMenu:', navMenu.className);
							});

							// Fermer le menu quand on clique sur un lien
							const navLinks = navMenu.querySelectorAll('a');
							navLinks.forEach(link => {
								link.addEventListener('click', function() {
									hamburger.classList.remove('active');
									navMenu.classList.remove('active');
									hamburger.setAttribute('aria-expanded', 'false');
								});
							});
						}

						// Attendre que le DOM soit chargé
						if (document.readyState === 'loading') {
							document.addEventListener('DOMContentLoaded', initBurger);
						} else {
							initBurger();
						}
					})();
				</script>

				<script>
					// Attendre que le DOM soit chargé
document.addEventListener('DOMContentLoaded', function () {
console.log('DOM chargé, initialisation du système admin...');

// Ctrl+A pour accéder au dashboard admin
document.addEventListener('keydown', function (event) {
if (event.ctrlKey && event.key === 'a') {
event.preventDefault();
window.location.href = '{{ path('app_admin_dashboard') }}';
}
});

// Système de 3 clics sur le titre pour accéder à l'admin
let clickCount = 0;
let clickTimer = null;
let lastClickTime = 0;

const siteLogo = document.getElementById('siteLogo');
if (siteLogo) {
console.log('=== LOGO TROUVÉ ===');
console.log('Element:', siteLogo);
console.log('TagName:', siteLogo.tagName);
console.log('ID:', siteLogo.id);

siteLogo.addEventListener('click', function (event) {
// TOUJOURS bloquer la navigation par défaut
event.preventDefault();
event.stopPropagation();

// Incrémenter le compteur
clickCount++;

// Réinitialiser le timer à chaque clic
if (clickTimer) {
clearTimeout(clickTimer);
}

// Si 3 clics atteints → ouvrir la modale
if (clickCount >= 3) {
const modalElement = document.getElementById('adminModal');
if (modalElement && typeof bootstrap !== 'undefined') {
const adminModal = new bootstrap.Modal(modalElement);
adminModal.show();
}
clickCount = 0;
return;
}

// Timer : si pas de 3ème clic dans 600ms → naviguer vers accueil
clickTimer = setTimeout(() => {
window.location.href = siteLogo.href;
clickCount = 0;
}, 600);
});
} else {
console.error('LOGO NON TROUVÉ !');
}

// Vérification du mot de passe admin
window.checkAdminPassword = function () {
const password = document.getElementById('adminPassword').value;
const correctPassword = 'admin123';

console.log('Vérification du mot de passe...');

if (password === correctPassword) {
console.log('Mot de passe correct, redirection...');
// Mot de passe correct, rediriger vers l'admin
window.location.href = '{{ path('app_admin_dashboard') }}';
} else {
console.log('Mot de passe incorrect');
// Mot de passe incorrect
document.getElementById('adminPassword').value = '';
document.getElementById('adminPassword').classList.add('is-invalid');

// Afficher un message d'erreur
const errorDiv = document.createElement('div');
errorDiv.className = 'invalid-feedback d-block';
errorDiv.textContent = 'Mot de passe incorrect !';

const existingError = document.querySelector('.invalid-feedback');
if (existingError) {
existingError.remove();
}

document.getElementById('adminPassword').parentNode.appendChild(errorDiv);

// Retirer la classe d'erreur après 3 secondes
setTimeout(() => {
document.getElementById('adminPassword').classList.remove('is-invalid');
const errorDiv = document.querySelector('.invalid-feedback');
if (errorDiv) {
errorDiv.remove();
}
}, 3000);
}
};

// Réinitialiser le compteur de clics si on clique ailleurs
document.addEventListener('click', function (event) {
const isLogoClick = event.target.closest('#siteLogo');
console.log('Clic global détecté - sur logo?', isLogoClick ? 'OUI' : 'NON');
if (!isLogoClick) {
console.log('Reset compteur (clic hors logo)');
clickCount = 0;
if (clickTimer) {
clearTimeout(clickTimer);
}
}
});

console.log('Système admin initialisé !');
});
				</script>

				<style>
					.navbar {
						background: linear-gradient(135deg, #4a7c59, #6b8e7a);
						padding: 1.5rem 0;
						box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
						min-height: 80px;
					}

					.navbar-brand {
						font-size: 1.5rem;
						font-weight: bold;
					}

					.navbar-nav .nav-link {
						padding: 0.75rem 1rem;
						font-weight: 500;
					}

					.login-btn,
					.logout-btn,
					.profile-link {
						transition: all 0.3s ease;
						display: flex;
						align-items: center;
						gap: 0.5rem;
					}

					.login-btn:hover,
					.logout-btn:hover,
					.profile-link:hover {
						transform: translateY(-2px);
					}

					.profile-link {
						color: #4a7c59 !important;
						font-weight: 600;
					}

					.profile-link img {
						width: 32px;
						height: 32px;
						border-radius: 50%;
						object-fit: cover;
						border: 2px solid #fff;
					}

					.logout-btn {
						color: #dc3545 !important;
					}

					.logout-btn:hover {
						color: #c82333 !important;
					}

					/* Styles pour la modale admin */
					#adminModal .modal-header {
						background: linear-gradient(135deg, #4a7c59, #6b8e7a);
						color: white;
					}

					#adminModal .modal-header .btn-close {
						filter: invert(1);
					}

					#adminModal .alert-info {
						background: linear-gradient(135deg, #d1ecf1, #bee5eb);
						border-color: #bee5eb;
						color: #0c5460;
					}

					#adminModal .btn-primary {
						background: linear-gradient(135deg, #4a7c59, #6b8e7a);
						border: none;
					}

					#adminModal .btn-primary:hover {
						background: linear-gradient(135deg, #3d6b4a, #5a7a66);
					}
				</style>
			</body>
		</html>
