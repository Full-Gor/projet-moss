{% extends 'base.html.twig' %}

{% block body %}
	<div class="container mt-5">
		<div
			class="row">
			<!-- Informations personnelles -->
			<div class="col-md-4">
				<div class="card profile-card">
					<div class="card-body text-center">
						<div class="profile-photo-container">
							<img src="{{ asset('images/profiles/' ~ userInfo.photo) }}" alt="Photo de profil" class="profile-photo" id="profilePhoto">
							<div class="photo-overlay">
								<i class="fas fa-camera"></i>
							</div>
						</div>
						<h4 class="mt-3">{{ userInfo.nom }}</h4>
						<p class="text-muted">{{ userInfo.email }}</p>

						<!-- Bouton pour ouvrir le modal de modification -->
						<button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#editProfileModal">
							<i class="fas fa-edit"></i>
							Modifier le profil
						</button>
					</div>
				</div>

				<!-- Statistiques -->
				<div class="card mt-4">
					<div class="card-body">
						<h5 class="card-title">Statistiques</h5>
						<div class="row text-center">
							<div class="col-6">
								<div class="stat-item">
									<h3>{{ commandes|length }}</h3>
									<small>Commandes</small>
								</div>
							</div>
							<div class="col-6">
								<div class="stat-item">
									<h3>{{ commandes|reduce((total, cmd) => total + (cmd.prix * cmd.quantite), 0) }}€</h3>
									<small>Total dépensé</small>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>

			<!-- Historique des commandes -->
			<div class="col-md-8">
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0">
							<i class="fas fa-history"></i>
							Historique des commandes
						</h5>
					</div>
					<div class="card-body">
						{% if commandes is empty %}
							<div class="text-center py-4">
								<i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
								<p class="text-muted">Aucune commande pour le moment</p>
								<a href="{{ path('app_produit') }}" class="btn btn-primary">
									<i class="fas fa-shopping-cart"></i>
									Faire ma première commande
								</a>
							</div>
						{% else %}
							<div class="table-responsive">
								<table class="table table-hover">
									<thead>
										<tr>
											<th>Produit</th>
											<th>Quantité</th>
											<th>Prix</th>
											<th>Date</th>
											<th>Statut</th>
										</tr>
									</thead>
									<tbody>
										{% for commande in commandes %}
											<tr>
												<td>
													<div class="d-flex align-items-center">
														<img src="{{ asset('images/hero3.jpg') }}" alt="Produit" class="product-thumb me-2">
														<span>{{ commande.produit }}</span>
													</div>
												</td>
												<td>{{ commande.quantite }}</td>
												<td>{{ commande.prix }}€</td>
												<td>{{ commande.dateCommande|date('d/m/Y H:i') }}</td>
												<td>
													<span class="badge bg-success">Livré</span>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal de modification du profil -->
	<div class="modal fade" id="editProfileModal" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">
						<i class="fas fa-user-edit"></i>
						Modifier le profil
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<form action="{{ path('app_profile_modifier') }}" method="POST" enctype="multipart/form-data">
					<div class="modal-body">
						<div
							class="row">
							<!-- Photo de profil -->
							<div class="col-md-4 text-center">
								<div class="profile-photo-container mb-3">
									<img src="{{ asset('images/profiles/' ~ userInfo.photo) }}" alt="Photo de profil" class="profile-photo" id="previewPhoto">
									<div class="photo-overlay">
										<i class="fas fa-camera"></i>
									</div>
								</div>
								<div class="mb-3">
									<label for="photo" class="form-label">Changer la photo</label>
									<input type="file" class="form-control" id="photo" name="photo" accept="image/jpeg,image/jpg,image/png">
									<div class="form-text">Formats acceptés : JPG, PNG (max 5MB)</div>
								</div>
							</div>

							<!-- Informations personnelles -->
							<div class="col-md-8">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label for="nom" class="form-label">
											<i class="fas fa-user"></i>
											Nom complet
										</label>
										<input type="text" class="form-control" id="nom" name="nom" value="{{ userInfo.nom }}" required>
									</div>
									<div class="col-md-6 mb-3">
										<label for="email" class="form-label">
											<i class="fas fa-envelope"></i>
											Email
										</label>
										<input type="email" class="form-control" id="email" name="email" value="{{ userInfo.email }}" required>
									</div>
								</div>
								<div class="mb-3">
									<label for="telephone" class="form-label">
										<i class="fas fa-phone"></i>
										Téléphone
									</label>
									<input type="tel" class="form-control" id="telephone" name="telephone" value="{{ userInfo.telephone }}">
								</div>
								<div class="mb-3">
									<label for="adresse" class="form-label">
										<i class="fas fa-map-marker-alt"></i>
										Adresse
									</label>
									<textarea class="form-control" id="adresse" name="adresse" rows="3">{{ userInfo.adresse }}</textarea>
								</div>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
							<i class="fas fa-times"></i>
							Annuler
						</button>
						<button type="submit" class="btn btn-primary">
							<i class="fas fa-save"></i>
							Sauvegarder
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<style>
		.profile-card {
			border: none;
			box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
			border-radius: 15px;
		}

		.profile-photo-container {
			position: relative;
			display: inline-block;
			cursor: pointer;
		}

		.profile-photo {
			width: 120px;
			height: 120px;
			border-radius: 50%;
			object-fit: cover;
			border: 4px solid #4a7c59;
			transition: all 0.3s ease;
		}

		.photo-overlay {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(74, 124, 89, 0.8);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			transition: opacity 0.3s ease;
			color: white;
			font-size: 1.5rem;
		}

		.profile-photo-container:hover .photo-overlay {
			opacity: 1;
		}

		.stat-item h3 {
			color: #4a7c59;
			font-weight: bold;
			margin-bottom: 0;
		}

		.stat-item small {
			color: #6c757d;
			font-size: 0.8rem;
		}

		.product-thumb {
			width: 40px;
			height: 40px;
			border-radius: 8px;
			object-fit: cover;
		}

		.badge {
			font-size: 0.75rem;
			padding: 0.5rem 0.75rem;
		}

		.modal-content {
			border: none;
			border-radius: 15px;
			box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
		}

		.modal-header {
			background: linear-gradient(135deg, #4a7c59, #6b8e7a);
			color: white;
			border-radius: 15px 15px 0 0;
		}

		.form-control {
			border: 2px solid #e9ecef;
			border-radius: 8px;
			padding: 0.75rem 1rem;
			transition: all 0.3s ease;
		}

		.form-control:focus {
			border-color: #4a7c59;
			box-shadow: 0 0 0 0.2rem rgba(74, 124, 89, 0.25);
		}

		.btn-primary {
			background: linear-gradient(135deg, #4a7c59, #6b8e7a);
			border: none;
			padding: 0.75rem 1.5rem;
			border-radius: 8px;
			font-weight: 600;
			transition: all 0.3s ease;
		}

		.btn-primary:hover {
			background: linear-gradient(135deg, #3d6b4a, #5a7a66);
			transform: translateY(-2px);
		}

		.form-label {
			font-weight: 600;
			color: #333;
			margin-bottom: 0.5rem;
		}

		.form-text {
			color: #6c757d;
			font-size: 0.875rem;
		}
	</style>

	<script>
		// Prévisualisation de la photo
document.getElementById('photo').addEventListener('change', function (e) {
const file = e.target.files[0];
if (file) {
const reader = new FileReader();
reader.onload = function (e) {
document.getElementById('previewPhoto').src = e.target.result;
};
reader.readAsDataURL(file);
}
});
	</script>
{% endblock %}
